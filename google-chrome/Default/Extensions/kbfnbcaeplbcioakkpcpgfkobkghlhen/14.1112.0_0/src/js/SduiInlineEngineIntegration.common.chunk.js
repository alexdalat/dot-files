(self.webpackChunk=self.webpackChunk||[]).push([[5275],{90377:(e,t,s)=>{s.r(t),s.d(t,{createSduiInlineEngine:()=>K,default:()=>X});var n=s(5114),r=s(21038),i=s(24055),a=s(12054),o=s(78929),c=s(81531),d=s(46680),l=s(26393),u=s(92843),p=s(9922),h=s(93508),g=s(16118),v=s(77176),m=s(28811),f=s(57050);function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,n=new Array(t);s<t;s++)n[s]=e[s];return n}function _(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var s=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=s){var n,r,i=[],a=!0,o=!1;try{for(s=s.call(e);!(a=(n=s.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){o=!0,r=e}finally{try{a||null==s.return||s.return()}finally{if(o)throw r}}return i}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return A(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);"Object"===s&&e.constructor&&(s=e.constructor.name);if("Map"===s||"Set"===s)return Array.from(s);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return A(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var w=function(){function e(t){var s=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._state=new Map,this._subs=new p.w.Keeper,this._log=c.C8.Logging.getLogger("SDUIInlineManager",d.i.TRACE,d.T.Manager.getColor()),this._subs.push(t.pipe(h.O(m.a.empty),g.G(),v.U((function(e){var t=b(e,2),s=t[0],n=t[1];return m.a.diff(s,n)})),v.U((function(e){return s._processSDUIItems(e)}))).subscribe())}var t,s,r;return t=e,(s=[{key:"getInlineItemForAlert",value:function(e){return n.fromNullable(this._state.get(e))}},{key:"_processSDUIItems",value:function(e){var t=this;(0,f.zG)(e,u.v.forEach((function(e){if(y(e)){var s=t;t._log.trace("inline item removed",{alertIds:e.alertIds,itemId:e.id}),e.alertIds.forEach((function(e){return s._state.delete(e)}))}}),(function(e,s){if(y(s)){var n=t;t._log.trace("inline item updated",{alertIds:s.alertIds,itemId:s.id}),s.alertIds.forEach((function(e){return n._state.set(e,s)}))}}),(function(e){if(y(e)){var s=t;t._log.trace("inline item added",{alertIds:e.alertIds,itemId:e.id}),e.alertIds.forEach((function(t){return s._state.set(t,e)}))}})))}},{key:"dispose",value:function(){this._subs.dispose()}}])&&_(t.prototype,s),r&&_(t,r),e}(),y=function(e){return(0,f.zG)(l.ab.findFirst(e.content,"inlineCard"),n.isSome)},I=s(31903),S=s(85985),C=s(80358),k=s(84286),H=s(38983),P=s(72812),E=s(50588),L=s(31668),U=s(22232),x=s(73975),M=s(41627),F=s(40151),T=s(95195),G=s(8125);class R{constructor(){this.feed=F.E,this.currentFeed=n.none,this.onFeedRemove=F.E,this.onFeedEmpty=F.E,this.header=F.E,this.pushFeed=()=>T.right(null),this.popFeed=G.Q1,this.focusCard=()=>T.right(null),this.notifyCardFocused=G.Q1,this.dispose=G.Q1}}var N,O=s(12469),V=s(19716),Q=s(73582),D=s(32952),W=s(19751),j=s(23063);class z{constructor(e,t,s){this.sduiManager=e,this.sduiFeedbackService=t,this.environment=s,this._focusedItem=H.h.create(n.none),this._sduiInlineCardActions=new D.xQ,this._subs=new p.w.Keeper,this.focusCard=e=>{this._focusedItem.set(n.some(e))},this.handleSduiCardAction=(e,t,s)=>{this._sduiInlineCardActions.next({cardAction:e,cardModel:t,match:s})},this.handleGButtonPopoverAction=e=>{this._sduiViewModel.sduiActionEvents.next(e)},this._handleSduiCardAction=({cardAction:e,match:t,cardModel:s})=>{this._sduiViewModel.sduiActionEvents.next(e),this._nativeHandling(e,t,s)},this.dispose=()=>this._subs.dispose(),this._sduiViewModel=new P.x(t,e,new R,this._focusedItem.view(n.map((e=>e.id)))),this._subs.push(this._sduiInlineCardActions.pipe(W.skipBy(N.eq)).subscribe(this._handleSduiCardAction),this._sduiViewModel)}_nativeHandling({actions:e,cardId:t,sourceId:s,scope:r},i,a){const o=e.filter((e=>"popAssistantFeed"===e.type||"pushAssistantFeed"===e.type||"focusAssistantCard"===e.type));(0,f.zG)(o,n.fromPredicate((e=>e.length>0)),n.map((e=>{a.onOpenExpandedViewBySduiAction(k.Oe.create(e,t,s,r))}))),e.forEach((e=>{switch(e.type){case"nextCard":case"prevCard":case"openSettings":case"openToneDetector":case"openFeedback":case"openLearnMore":case"transition":case"openCreateSnippetModal":case"nativeOpenAssistant":case"selectAlternative":case"highlightAlert":case"showHighlights":case"hideHighlights":case"notify":case"switchView":case"newRevision":case"interactPopover":case"closePopover":case"pushAssistantFeed":case"popAssistantFeed":case"focusAssistantCard":return;case"openLink":return void this.environment.actions.openPopup(new L.Z(e.url));case"copyToClipboard":return void(0,f.zG)((0,M.v)(e.text),j.q(1)).subscribe();case"stopApplyingAlerts":case"upgradeToPremium":return a.openPlanComparisonPage({forceUtmCampaign:Q.L.Place.assistantCardList}),void i.hide();case"applyAlerts":if(null==i.alert)return;return(0,f.zG)((0,O.UQ)(i.alert,i.plainText),(e=>new V.U_(e,(e=>i.replace(null!=e?e:"",!1)))),(t=>(0,f.zG)(n.fromNullable(t.replacements[e.alternativeIndex]),n.map((e=>t.getOnReplace(e)()))))),void i.hide();case"closeCard":case"removeRoot":return void i.hide();case"removeAlerts":return i.ignore(),void i.hide();default:(0,U.L0)(e)}}))}}!function(e){e.eq=x.MW({cardAction:E.t.eq})}(N||(N={}));var B=s(4477);class Z extends B.J{constructor(){super(),this._popoverActionsHandler=H.h.create(n.none)}setPopoverActionsHandler(e){this._popoverActionsHandler.set(n.some(e))}get popoverActionsHandlerAtom(){return this._popoverActionsHandler}}class q{constructor(){this.activePopoverStack=H.h.create(n.none),this.activePopoverView=H.h.create(n.none),this._popoverActionsHandler=H.h.create(n.none)}addPopover(e,t){}getInteractionActions(e,t,s){return[]}removePopover(e,t){}switchView(e){}get popoverActionsHandlerAtom(){return this._popoverActionsHandler}setPopoverActionsHandler(e){}}const K=(e,t,s,c,d,l=!1)=>{const u=new p.w.Keeper,h=(0,f.ls)((e=>e.toString()),s,n.fromNullable,n.map((e=>r.j.AlertId.from(e.id)))),g=e.capiEvents.pipe(S.h(C.hX.is("sdui_add","sdui_remove","sdui_update")),S.h((e=>"sdui_remove"===e.kind||k.D1.InlineCard.isInlineCard(e.sdui)||k.D1.PopoverStack.isPopoverStack(e.sdui))),S.h(i.e.isSduiEvent),v.U(a.al.fromSource(a.i5.CAPI))),m=l?new Z:new q,A=new o.G(g,h,m),_=new w(A.state),b=new I.Q({sendUserAction:c}),y=new z(A,b,d);return m.setPopoverActionsHandler(y),u.push(t.subscribe((e=>A.notifyAlertsChanged())),e.capiEvents.pipe(S.h(C.hX.is("session_started")),S.h((e=>e.isNewSession))).subscribe((e=>A.onSessionStarted())),e.capiEvents.pipe(S.h(C.hX.is("finish")),S.h((e=>0===e.revision))).subscribe((e=>A.onFirstCheckingFinished())),A,_,y),{sduiBufferService:e,sduiManager:A,sduiInlineManager:_,sduiFeedbackService:b,inlineCardViewModel:y,dispose:()=>{u.dispose()}}},X={createSduiInlineEngine:K}},73582:(e,t,s)=>{s.d(t,{L:()=>n,x:()=>I});var n,r=s(40327),i=s(65421),a=s(39354),o=s(65451),c=s(66896),d=s(74660),l=s(6782),u=s(4390),p=s(2844),h=s(77176),g=s(98403),v=s(5114),m=s(8125),f=s(95574),A=s(95195),_=s(38983),b=s(81531),w=s(62111),y=s(23423);!function(e){let t;!function(e){e.gdocsSidebarCardList="gdocsSidebarCardList",e.gdocsGoals="gdocsGoals",e.assistantCardList="assistantCardList",e.extensionSettingsAssistant="extensionSettingsAssistant",e.toneSuggestion="toneSuggestion"}(t=e.Place||(e.Place={}))}(n||(n={}));class I{constructor(e,t,s,n){this._alertsList=e,this._lensState=t,this._maxAlertCategories=s,this.gnar=n,this._log=b.C8.Logging.getLogger("UpgradeViewModel"),this._advancedAlerts=_.h.create([]),this.advancedAlerts=this._advancedAlerts.view((e=>e.length>0?v.some({count:e.length,alerts:()=>this._formatLiteAlerts(I._getGroupedLiteAlerts(e))}):v.none)),this._formatLiteAlerts=e=>{const t=e.slice(0,this._maxAlertCategories),s=e.slice(this._maxAlertCategories).map((e=>e.count)).reduce(m.Sm,0);return s>0?[...t,{group:"",category:"",categoryHuman:"more...",count:s,lensName:"",bundleInfo:v.none}]:t},this._connectionId=o._.createWithRandomId("sidebar"),p.aj([this._lensState.view("currentLens").view("id").view(c.R.isPriority).view((e=>e?e=>d.bZ.isRegistered(e)&&d.bZ.isPremium(e)&&d.bZ.isPriority(e):e=>d.bZ.isRegistered(e)&&d.bZ.isPremium(e))),this._alertsList.state]).pipe(h.U((([e,t])=>u.p.reduce([],((t,{alert:s})=>(e(s)&&t.push(s),t)))(t)))).subscribe(g.wW(this._advancedAlerts))}trackUpgradeButtonShow(e){const t=this._advancedAlerts.get();(0,y.n)(this.gnar,{placement:e.placement,bannerType:e.bannerType,advancedAlerts:t,upgradeHookName:e.upgradeHookName,upgradeHookSlot:e.upgradeHookSlot}),this.gnar.assistantExpandedUpgradeHookShow(t.length,100),(0,w.Tb)().upgradeHooks.showUpgradeHook(e.upgradeHookName,e.upgradeHookSlot)}trackUpgradeButtonClick(e){const t=this._advancedAlerts.get();(0,y.Q)(this.gnar,{placement:e.placement,bannerType:e.bannerType,advancedAlerts:t,upgradeHookName:e.upgradeHookName,upgradeHookSlot:e.upgradeHookSlot}),(0,w.Tb)().upgradeHooks.clickUpgradeHook(e.upgradeHookName,e.upgradeHookSlot)}openUpgradeUrl(e){(0,r.pipe)(f.tryCatchError((()=>{(0,a.P4)().openSubscriptionDialog({currentAlerts:this._getCapiAlerts(),isAnonymousUser:!1,isFromEmail:!1,forceUtmCampaign:e})})),A.getOrElse((e=>this._log.fatal("unexpected error on open upgrade page",e))))}_getCapiAlerts(){return this._advancedAlerts.get().map((e=>(0,i.IM)(I._toRawAlertWithPossibleWrongId(e),o.Q.create(this._connectionId,0))))}static _getGroupedLiteAlerts(e){return l.Q.group(e.map((e=>e.toLiteAlert())))}static _toRawAlertWithPossibleWrongId(e){return{...e.toRawAlert(),id:(0,r.pipe)(e.rawId,v.getOrElse((()=>e.id)))}}}}}]);